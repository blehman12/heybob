<div class="row">
  <div class="col-md-8">
    <% if @current_event %>
      <!-- Current Event Card -->
      <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h4><%= @current_event.name %></h4>
          <% if @my_role == 'vendor' %>
            <span class="badge bg-warning">Vendor</span>
          <% elsif @my_role == 'organizer' %>
            <span class="badge bg-success">Organizer</span>
          <% end %>
        </div>
        <div class="card-body">
          <p><strong>Date:</strong> <%= @current_event.event_date&.strftime("%A, %B %d, %Y") %></p>
          
          <% if @current_event.start_time %>
            <p><strong>Time:</strong> 
              <%= @current_event.start_time.strftime("%I:%M %p") %>
              <% if @current_event.end_time %>
                - <%= @current_event.end_time.strftime("%I:%M %p") %>
              <% end %>
            </p>
          <% end %>
          
          <% if @current_event.venue %>
            <p><strong>Location:</strong> <%= @current_event.venue.name %><br>
              <small class="text-muted"><%= @current_event.venue.address %></small>
            </p>
          <% end %>
          
          <% if @current_event.rsvp_deadline %>
            <p><strong>RSVP Deadline:</strong> <%= @current_event.rsvp_deadline.strftime("%B %d, %Y at %I:%M %p") %></p>
          <% end %>
          
          <% if @current_event.max_attendees %>
            <p><strong>Capacity:</strong> <%= @current_event.max_attendees %> attendees
              <% if @current_event.respond_to?(:spots_remaining) %>
                <small class="text-muted">(<%= @current_event.spots_remaining %> spots remaining)</small>
              <% end %>
            </p>
          <% end %>
          
          <% if @current_event.description.present? %>
            <hr>
            <p><strong>About this event:</strong></p>
            <%= simple_format(@current_event.description) %>
          <% end %>
        </div>
      </div>

      <!-- RSVP Card -->
      <div class="card mb-4">
        <div class="card-header">
          <h5>Your RSVP Status: 
            <% 
              status_class = case @user_rsvp_status.to_s
                           when 'yes', '1' then 'success'
                           when 'maybe', '3' then 'warning' 
                           when 'no', '2' then 'danger'
                           else 'secondary'
                           end
            %>
            <span class="badge bg-<%= status_class %>">
              <%= @user_rsvp_status.to_s.humanize %>
            </span>
          </h5>
        </div>
        <div class="card-body">
          <% if @current_event.rsvp_deadline && @current_event.rsvp_deadline > Time.current %>
            <%= form_with url: update_rsvp_path(@current_event.id), method: :patch, local: true do |form| %>
              <div class="btn-group d-flex mb-3" role="group" aria-label="RSVP Options">
                <%= form.submit "Yes, I'll be there!", 
                    name: "status", 
                    value: "yes", 
                    class: "btn #{(@user_rsvp_status.to_s == 'yes' || @user_rsvp_status.to_s == '1') ? 'btn-success' : 'btn-outline-success'} flex-fill" %>
                
                <%= form.submit "Maybe", 
                    name: "status", 
                    value: "maybe", 
                    class: "btn #{(@user_rsvp_status.to_s == 'maybe' || @user_rsvp_status.to_s == '3') ? 'btn-warning' : 'btn-outline-warning'} flex-fill" %>
                
                <%= form.submit "Can't make it", 
                    name: "status", 
                    value: "no", 
                    class: "btn #{(@user_rsvp_status.to_s == 'no' || @user_rsvp_status.to_s == '2') ? 'btn-danger' : 'btn-outline-danger'} flex-fill" %>
              </div>
              
              <% if (@user_rsvp_status.to_s == 'yes' || @user_rsvp_status.to_s == '1') %>
                <div class="alert alert-success">
                  <strong>Great!</strong> We're looking forward to seeing you there!
                </div>
              <% end %>
            <% end %>
          <% else %>
            <div class="alert alert-warning">
              <i class="bi bi-clock"></i> RSVP deadline has passed
            </div>
          <% end %>
        </div>
      </div>
    <% else %>
      <!-- No Events Message -->
      <div class="alert alert-info">
        <h4><i class="bi bi-calendar-x"></i> No Current Events</h4>
        <p>Check back soon for upcoming events! In the meantime, update your profile to the right.</p>
      </div>
    <% end %>
  </div>
  
  <!-- Sidebar -->
  <div class="col-md-4">
    <!-- User Profile Card -->
    <div class="card mb-3">
      <div class="card-header">
        <h5><i class="bi bi-person-circle"></i> Your Profile</h5>
      </div>
      <div class="card-body">
        <p><strong>Name:</strong> <%= current_user.full_name %></p>
        <p><strong>Email:</strong> <%= current_user.email %></p>
        <p><strong>Company:</strong> <%= current_user.company %></p>
        <% if current_user.phone.present? %>
          <p><strong>Phone:</strong> <%= current_user.phone %></p>
        <% end %>
        <% if current_user.admin? %>
          <p><span class="badge bg-primary">Administrator</span></p>
        <% end %>
        <hr>
        <div class="d-grid">
          <%= link_to "Edit Profile", edit_user_registration_path, class: "btn btn-outline-primary btn-sm" %>
        </div>
      </div>
    </div>

    <!-- My Events Card -->
    <% if @my_events&.any? %>
      <div class="card">
        <div class="card-header">
          <h6><i class="bi bi-calendar-event"></i> My Events (<%= @my_events.count %>)</h6>
        </div>
        <div class="card-body">
          <% @my_events.each do |event| %>
            <% participant = current_user.event_participants.find_by(event: event) %>
            <div class="mb-3 pb-3 border-bottom">
              <strong><%= event.name %></strong><br>
              <small class="text-muted">
                <i class="bi bi-calendar3"></i> <%= event.event_date&.strftime("%b %d, %Y") %>
              </small>
              
              <% if participant %>
                <br>
                <% 
                  participant_status_class = case participant.rsvp_status.to_s
                                           when 'yes', '1' then 'success'
                                           when 'maybe', '3' then 'warning'
                                           when 'no', '2' then 'danger'
                                           else 'secondary'
                                           end
                %>
                <span class="badge bg-<%= participant_status_class %>">
                  <%= participant.rsvp_status.to_s.humanize %>
                </span>
                
                <% if participant.role.to_s == 'vendor' || participant.role.to_s == '1' %>
                  <span class="badge bg-warning text-dark">Vendor</span>
                <% elsif participant.role.to_s == 'organizer' || participant.role.to_s == '2' %>
                  <span class="badge bg-info text-dark">Organizer</span>
                <% end %>
                
                <% if participant.checked_in? %>
                  <br><small class="text-success"><i class="bi bi-check-circle-fill"></i> Checked in</small>
                <% end %>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    <% else %>
      <div class="card">
        <div class="card-body text-center text-muted">
          <i class="bi bi-calendar-x" style="font-size: 2rem;"></i>
          <p class="mt-2 mb-0">No events yet</p>
        </div>
      </div>
    <% end %>
    
    <!-- Quick Links (if admin) -->
    <% if current_user.admin? %>
      <div class="card mt-3">
        <div class="card-header">
          <h6><i class="bi bi-gear"></i> Quick Admin Links</h6>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <%= link_to "Admin Dashboard", admin_root_path, class: "btn btn-sm btn-outline-primary" %>
            <%= link_to "Manage Events", admin_events_path, class: "btn btn-sm btn-outline-success" %>
            <%= link_to "Manage Users", admin_users_path, class: "btn btn-sm btn-outline-info" %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>
